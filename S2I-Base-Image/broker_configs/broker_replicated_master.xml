<?xml version='1.0'?>

<configuration xmlns="urn:activemq"
               xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
               xsi:schemaLocation="urn:activemq /schema/artemis-configuration.xsd">

    <core xmlns="urn:activemq:core">

        <persistence-enabled>true</persistence-enabled>

        <!-- =========== DIRECTORY CONFIG =========== -->

        <paging-directory>./data/paging</paging-directory>
        <bindings-directory>./data/bindings</bindings-directory>
        <large-messages-directory>./data/large-messages</large-messages-directory>

        <!-- =========== JOURNAL CONFIG =========== -->

        <journal-type>ASYNCIO</journal-type>
        <journal-directory>./data/journal</journal-directory>
        <journal-min-files>2</journal-min-files>
        <journal-pool-files>-1</journal-pool-files>
        <journal-buffer-timeout>1819999</journal-buffer-timeout>
        <journal-datasync>true</journal-datasync>
        
        <!-- how often we are looking for how many bytes are being used on the disk in ms -->
      	<disk-scan-period>5000</disk-scan-period>

      	<!-- once the disk hits this limit the system will block, or close the connection in certain protocols
           that won't support flow control. -->
      	<max-disk-usage>90</max-disk-usage>

      	<!-- the system will enter into page mode once you hit this limit.
           This is an estimate in bytes of how much the messages are using in memory -->
      	<global-max-size>100Mb</global-max-size>

      	<!-- should the broker detect dead locks and other issues -->
      	<!-- NOT WORKING ON OC     	
      	<critical-analyzer>true</critical-analyzer>

     	 <critical-analyzer-timeout>120000</critical-analyzer-timeout>

      	<critical-analyzer-check-period>60000</critical-analyzer-check-period>

      	<critical-analyzer-policy>HALT</critical-analyzer-policy>
		-->
        <!-- =========== CONNECTION CONFIG =========== -->

        <connectors>
            <!-- default connector: ActiveMQ Artemis, OpenWire, STOMP, AMQP, MQTT, & HornetQ -->
            <connector name="artemis">tcp://0.0.0.0:${ARTEMIS_PORT}</connector>
        </connectors>
        <acceptors>
            <acceptor name="artemis">tcp://0.0.0.0:${ARTEMIS_PORT}?tcpSendBufferSize=1048576;tcpReceiveBufferSize=1048576;protocols=CORE,AMQP,STOMP,HORNETQ,MQTT,OPENWIRE;useEpoll=true;amqpCredits=1000;amqpLowCredits=300</acceptor>
        </acceptors>

        <!-- =========== CLUSTERING CONFIG =========== -->

        <!--<cluster-user>exampleUser</cluster-user>
        <cluster-password>secret</cluster-password>-->

        <broadcast-groups>
        	<broadcast-group name="my-broadcast-group">
           		<group-address>${udp-address:231.7.7.7}</group-address>
                <group-port>9876</group-port>
                <broadcast-period>5000</broadcast-period>
                <connector-ref>artemis</connector-ref>
            </broadcast-group>
        </broadcast-groups>

        <discovery-groups>
      		<discovery-group name="my-discovery-group">
                <group-address>${udp-address:231.7.7.7}</group-address>
                <group-port>9876</group-port>
                <refresh-timeout>10000</refresh-timeout>
            </discovery-group>
        </discovery-groups>

        <cluster-connections>
       		<cluster-connection name="my-cluster">
         		<connector-ref>artemis</connector-ref>
                <message-load-balancing>ON_DEMAND</message-load-balancing>
                <max-hops>0</max-hops>
                <discovery-group-ref discovery-group-name="test-discovery-group"/>
            </cluster-connection>
        </cluster-connections>

        <!-- =========== HIGH AVAILABILITY CONFIG =========== -->

        <ha-policy>
            <replication>
                <master>
                	<group-name>group13</group-name>
                	<check-for-live-server>true</check-for-live-server>
        			<!--  <failover-on-shutdown>true</failover-on-shutdown>-->
                </master>
            </replication>
        </ha-policy>

        <!-- =========== SECURITY CONFIG =========== -->
		<!--
        <management-address>activemq.management</management-address>
        <management-notification-address>jms.topic.notificationsTopic</management-notification-address>
		-->
        <security-settings>
         <security-setting match="#">
            <permission type="createNonDurableQueue" roles="amq"/>
            <permission type="deleteNonDurableQueue" roles="amq"/>
            <permission type="createDurableQueue" roles="amq"/>
            <permission type="deleteDurableQueue" roles="amq"/>
            <permission type="createAddress" roles="amq"/>
            <permission type="deleteAddress" roles="amq"/>
            <permission type="consume" roles="amq"/>
            <permission type="browse" roles="amq"/>
            <permission type="send" roles="amq"/>
            <!-- we need this otherwise ./artemis data imp wouldn't work -->
            <permission type="manage" roles="amq"/>
         </security-setting>
      	</security-settings>

        <!-- =========== QUEUE/TOPIC CONFIG =========== -->

        <address-settings>
         <!-- if you define auto-create on certain queues, management has to be auto-create -->
         <address-setting match="activemq.management#">
            <dead-letter-address>DLQ</dead-letter-address>
            <expiry-address>expiryQueue</expiry-address>
            <redelivery-delay>0</redelivery-delay>
            <!-- with -1 only the global-max-size is in use for limiting -->
            <max-size-bytes>-1</max-size-bytes>
            <message-counter-history-day-limit>10</message-counter-history-day-limit>
            <address-full-policy>PAGE</address-full-policy>
            <auto-create-queues>true</auto-create-queues>
            <auto-create-addresses>true</auto-create-addresses>
            <auto-create-jms-queues>true</auto-create-jms-queues>
            <auto-create-jms-topics>true</auto-create-jms-topics>
         </address-setting>
         <!--default for catch all-->
         <address-setting match="#">
            <dead-letter-address>DLQ</dead-letter-address>
            <expiry-address>expiryQueue</expiry-address>
         <!--   <message-expiry-scan-period>50000</message-expiry-scan-period>
            <message-expiry-thread-priority>8</message-expiry-thread-priority>-->
            <redelivery-delay>0</redelivery-delay>
            <!-- with -1 only the global-max-size is in use for limiting -->
            <max-size-bytes>-1</max-size-bytes>
            <message-counter-history-day-limit>10</message-counter-history-day-limit>
            <address-full-policy>PAGE</address-full-policy>
            <auto-create-queues>true</auto-create-queues>
            <auto-create-addresses>true</auto-create-addresses>
            <auto-create-jms-queues>true</auto-create-jms-queues>
            <auto-create-jms-topics>true</auto-create-jms-topics>
         </address-setting>
      	</address-settings>

        <message-expiry-scan-period>50000</message-expiry-scan-period>
        <message-expiry-thread-priority>8</message-expiry-thread-priority>
      	<addresses>
        <address name="DLQ">
            <anycast>
               <queue name="DLQ" />
            </anycast>
         </address>
         <address name="expiryQueue">
            <anycast>
               <queue name="expiryQueue" />
            </anycast>
         </address>
  	 	<address name="mary.exampleQueue">
            <anycast>
                <queue name="mary.exampleQueue"/>
            </anycast>
        </address>
	  	<address name="/example/endpoint"> 
  	    <multicast>
    		<queue name="subscriber-1">
      			<durable>true</durable>
    		</queue>
    		<queue name="subscriber-2">
     			 <durable>false</durable>
    		</queue>
  	    </multicast>
  	    
	</address>
	 <address name="topic.foo">
            <multicast>
        	<queue name="client123.topic.foo"/>
       		<queue name="client456.topic.foo"/>
      	    </multicast>
   	 </address>
    </addresses>

    </core>
</configuration>